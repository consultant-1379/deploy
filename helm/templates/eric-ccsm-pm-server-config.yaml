{{- if ( index .Values "eric-ccsm-adp" "eric-pm-server" "server" "configMapOverrideName" ) }}
{{- if ( ne ( index .Values "eric-ccsm-adp" "eric-pm-server" "server" "configMapOverrideName" ) "eric-adp-5g-udm-pm-server-config") }}
apiVersion: v1
kind: ConfigMap
metadata:
  name:  {{ template "eric-ccsm.pm-server-config.name" . }}
{{- include "eric-ccsm.helm-labels" . | indent 2 }}
{{- include "eric-ccsm.helm-annotations" . | indent 2 }}
data:
{{- if or ( index .Values "eric-ccsm-udm" "enabled" ) ( index .Values "eric-ccsm-ausf" "enabled" ) ( index .Values "eric-ccsm-eir" "enabled" ) ( index .Values "eric-ccsm-hssepc" "enabled" ) ( index .Values "eric-ccsm-hssims" "enabled" ) }}
  eric-adp-5g-udm-pol-rules.yml: |
    groups:
      - name: eric_adp_persistent_volume_used_ratio
        rules:
          - record: elasticsearch_volume_stats_used:ratio
            expr: sum by (name) ((1 - elasticsearch_filesystem_data_free_bytes {name=~"eric-data-search-engine-data.*"} / (elasticsearch_filesystem_data_size_bytes {name=~"eric-data-search-engine-data.*"}) > 0) * 100 or vector (0))
          - record: pms_volume_stats_used:ratio
            expr: pms_volume_stats_used_bytes / (pms_volume_stats_capacity_bytes > 0) * 100 or vector (0)
          - record: pmbr_volume_stats_used:ratio
            expr: pmbr_volume_stats_used_bytes / (pmbr_volume_stats_capacity_bytes > 0) * 100 or vector (0)
          - record: kubelet_volume_stats_used:ratio
            expr: kubelet_volume_stats_used_bytes / kubelet_volume_stats_capacity_bytes * 100
  eric-nrfagent-rules.yml: |
    groups:
      - name: eric_nrfagent
        rules:
          - record: remoteendpoint_statuscode:eric_nrfagent_discovery_unsuccessful_responses_sent:ratio
            expr: |2
              sum(delta(eric_nrfagent_discovery_unsuccessful_responses_sent[1m])) by (remote_endpoint,status_code)
              /
              ignoring(status_code) group_left sum(delta(eric_nrfagent_discovery_requests_recv[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint_statuscode:eric_svc_routing_agent_unsuccessful_responses_sent:ratio
            expr: |2
              sum(delta(eric_svc_routing_agent_unsuccessful_responses_sent[1m])) by (remote_endpoint,status_code)
              /
              ignoring(status_code) group_left sum(delta(eric_svc_routing_agent_requests_recv[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint_statuscode:eric_nrfagent_discovery_nnrf_disc_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_disc_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-discovery"}[1m])) by (remote_endpoint,status_code)
              /
              ignoring(status_code) group_left sum(delta(eric_nrfagent_nnrf_disc_requests_sent{nf_service_id="eric-nrfagent-discovery"}[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint_statuscode:eric_nrfagent_register_nnrf_disc_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_disc_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-register"}[1m])) by (remote_endpoint,status_code)
              /
              ignoring(status_code) group_left sum(delta(eric_nrfagent_nnrf_disc_requests_sent{nf_service_id="eric-nrfagent-register"}[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint_statuscode:eric_nrfagent_discovery_nnrf_nfm_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_nfm_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-discovery"}[1m])) by (remote_endpoint,status_code)
              /
              ignoring(status_code) group_left sum(delta(eric_nrfagent_nnrf_nfm_requests_sent{nf_service_id="eric-nrfagent-discovery"}[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint_statuscode:eric_nrfagent_register_nnrf_nfm_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_nfm_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-register"}[1m])) by (remote_endpoint,status_code)
              /
              ignoring(status_code) group_left sum(delta(eric_nrfagent_nnrf_nfm_requests_sent{nf_service_id="eric-nrfagent-register"}[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint_statuscode:eric_nrfagent_accesstoken_nnrf_oauth2_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_oauth2_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-accesstoken"}[1m])) by (remote_endpoint,status_code)
              /
              ignoring(status_code) group_left sum(delta(eric_nrfagent_nnrf_oauth2_requests_sent{nf_service_id="eric-nrfagent-accesstoken"}[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint_detailedinfo:eric_nrfagent_discovery_unsuccessful_responses_sent:ratio
            expr: |2
              sum(delta(eric_nrfagent_discovery_unsuccessful_responses_sent[1m])) by (remote_endpoint,detailed_info)
              /
              ignoring(detailed_info) group_left sum(delta(eric_nrfagent_discovery_requests_recv[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint_detailedinfo:eric_svc_routing_agent_unsuccessful_responses_sent:ratio
            expr: |2
              sum(delta(eric_svc_routing_agent_unsuccessful_responses_sent[1m])) by (remote_endpoint,detailed_info)
              /
              ignoring(detailed_info) group_left sum(delta(eric_svc_routing_agent_requests_recv[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint_detailedinfo:eric_nrfagent_discovery_nnrf_disc_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_disc_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-discovery"}[1m])) by (remote_endpoint,detailed_info)
              /
              ignoring(detailed_info) group_left sum(delta(eric_nrfagent_nnrf_disc_requests_sent{nf_service_id="eric-nrfagent-discovery"}[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint_detailedinfo:eric_nrfagent_register_nnrf_disc_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_disc_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-register"}[1m])) by (remote_endpoint,detailed_info)
              /
              ignoring(detailed_info) group_left sum(delta(eric_nrfagent_nnrf_disc_requests_sent{nf_service_id="eric-nrfagent-register"}[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint_detailedinfo:eric_nrfagent_discovery_nnrf_nfm_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_nfm_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-discovery"}[1m])) by (remote_endpoint,detailed_info)
              /
              ignoring(detailed_info) group_left sum(delta(eric_nrfagent_nnrf_nfm_requests_sent{nf_service_id="eric-nrfagent-discovery"}[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint_detailedinfo:eric_nrfagent_register_nnrf_nfm_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_nfm_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-register"}[1m])) by (remote_endpoint,detailed_info)
              /
              ignoring(detailed_info) group_left sum(delta(eric_nrfagent_nnrf_nfm_requests_sent{nf_service_id="eric-nrfagent-register"}[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint_detailedinfo:eric_nrfagent_accesstoken_nnrf_oauth2_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_oauth2_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-accesstoken"}[1m])) by (remote_endpoint,detailed_info)
              /
              ignoring(detailed_info) group_left sum(delta(eric_nrfagent_nnrf_oauth2_requests_sent{nf_service_id="eric-nrfagent-accesstoken"}[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint:eric_nrfagent_discovery_unsuccessful_responses_sent:ratio
            expr: |2
              sum(delta(eric_nrfagent_discovery_unsuccessful_responses_sent[1m])) by (remote_endpoint)
              /
              sum(delta(eric_nrfagent_discovery_requests_recv[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint:eric_svc_routing_agent_unsuccessful_responses_sent:ratio
            expr: |2
              sum(delta(eric_svc_routing_agent_unsuccessful_responses_sent[1m])) by (remote_endpoint)
              /
              sum(delta(eric_svc_routing_agent_requests_recv[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint:eric_nrfagent_discovery_nnrf_disc_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_disc_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-discovery"}[1m])) by (remote_endpoint)
              /
              sum(delta(eric_nrfagent_nnrf_disc_requests_sent{nf_service_id="eric-nrfagent-discovery"}[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint:eric_nrfagent_register_nnrf_disc_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_disc_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-register"}[1m])) by (remote_endpoint)
              /
              sum(delta(eric_nrfagent_nnrf_disc_requests_sent{nf_service_id="eric-nrfagent-register"}[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint:eric_nrfagent_discovery_nnrf_nfm_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_nfm_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-discovery"}[1m])) by (remote_endpoint)
              /
              sum(delta(eric_nrfagent_nnrf_nfm_requests_sent{nf_service_id="eric-nrfagent-discovery"}[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint:eric_nrfagent_register_nnrf_nfm_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_nfm_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-register"}[1m])) by (remote_endpoint)
              /
              sum(delta(eric_nrfagent_nnrf_nfm_requests_sent{nf_service_id="eric-nrfagent-register"}[1m])> 0 ) by (remote_endpoint) * 100
          - record: remoteendpoint:eric_nrfagent_accesstoken_nnrf_oauth2_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_oauth2_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-accesstoken"}[1m])) by (remote_endpoint)
              /
              sum(delta(eric_nrfagent_nnrf_oauth2_requests_sent{nf_service_id="eric-nrfagent-accesstoken"}[1m])> 0 ) by (remote_endpoint) * 100
          - record: statuscode:eric_nrfagent_discovery_unsuccessful_responses_sent:ratio
            expr: |2
              sum(delta(eric_nrfagent_discovery_unsuccessful_responses_sent[1m])) by (status_code)
              /
              ignoring(status_code) group_left sum(delta(eric_nrfagent_discovery_requests_recv[1m])> 0 ) * 100
          - record: statuscode:eric_svc_routing_agent_unsuccessful_responses_sent:ratio
            expr: |2
              sum(delta(eric_svc_routing_agent_unsuccessful_responses_sent[1m])) by (status_code)
              /
              ignoring(status_code) group_left sum(delta(eric_svc_routing_agent_requests_recv[1m])> 0 ) * 100
          - record: statuscode:eric_nrfagent_discovery_nnrf_disc_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_disc_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-discovery"}[1m])) by (status_code)
              /
              ignoring(status_code) group_left sum(delta(eric_nrfagent_nnrf_disc_requests_sent{nf_service_id="eric-nrfagent-discovery"}[1m])> 0 ) * 100
          - record: statuscode:eric_nrfagent_register_nnrf_disc_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_disc_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-register"}[1m])) by (status_code)
              /
              ignoring(status_code) group_left sum(delta(eric_nrfagent_nnrf_disc_requests_sent{nf_service_id="eric-nrfagent-register"}[1m])> 0 ) * 100
          - record: statuscode:eric_nrfagent_discovery_nnrf_nfm_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_nfm_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-discovery"}[1m])) by (status_code)
              /
              ignoring(status_code) group_left sum(delta(eric_nrfagent_nnrf_nfm_requests_sent{nf_service_id="eric-nrfagent-discovery"}[1m])> 0 ) * 100
          - record: statuscode:eric_nrfagent_register_nnrf_nfm_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_nfm_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-register"}[1m])) by (status_code)
              /
              ignoring(status_code) group_left sum(delta(eric_nrfagent_nnrf_nfm_requests_sent{nf_service_id="eric-nrfagent-register"}[1m])> 0 ) * 100
          - record: statuscode:eric_nrfagent_accesstoken_nnrf_oauth2_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_oauth2_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-accesstoken"}[1m])) by (status_code)
              /
              ignoring(status_code) group_left sum(delta(eric_nrfagent_nnrf_oauth2_requests_sent{nf_service_id="eric-nrfagent-accesstoken"}[1m])> 0 ) * 100
          - record: detailedinfo:eric_nrfagent_discovery_unsuccessful_responses_sent:ratio
            expr: |2
              sum(delta(eric_nrfagent_discovery_unsuccessful_responses_sent[1m])) by (detailed_info)
              /
              ignoring(detailed_info) group_left sum(delta(eric_nrfagent_discovery_requests_recv[1m])> 0 ) * 100
          - record: detailedinfo:eric_svc_routing_agent_unsuccessful_responses_sent:ratio
            expr: |2
              sum(delta(eric_svc_routing_agent_unsuccessful_responses_sent[1m])) by (detailed_info)
              /
              ignoring(detailed_info) group_left sum(delta(eric_svc_routing_agent_requests_recv[1m])> 0 ) * 100
          - record: detailedinfo:eric_nrfagent_discovery_nnrf_disc_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_disc_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-discovery"}[1m])) by (detailed_info)
              /
              ignoring(detailed_info) group_left sum(delta(eric_nrfagent_nnrf_disc_requests_sent{nf_service_id="eric-nrfagent-discovery"}[1m])> 0 ) * 100
          - record: detailedinfo:eric_nrfagent_register_nnrf_disc_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_disc_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-register"}[1m])) by (detailed_info)
              /
              ignoring(detailed_info) group_left sum(delta(eric_nrfagent_nnrf_disc_requests_sent{nf_service_id="eric-nrfagent-register"}[1m])> 0 ) * 100
          - record: detailedinfo:eric_nrfagent_discovery_nnrf_nfm_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_nfm_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-discovery"}[1m])) by (detailed_info)
              /
              ignoring(detailed_info) group_left sum(delta(eric_nrfagent_nnrf_nfm_requests_sent{nf_service_id="eric-nrfagent-discovery"}[1m])> 0 ) * 100
          - record: detailedinfo:eric_nrfagent_register_nnrf_nfm_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_nfm_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-register"}[1m])) by (detailed_info)
              /
              ignoring(detailed_info) group_left sum(delta(eric_nrfagent_nnrf_nfm_requests_sent{nf_service_id="eric-nrfagent-register"}[1m])> 0 ) * 100
          - record: detailedinfo:eric_nrfagent_accesstoken_nnrf_oauth2_unsuccessful_responses_recv:ratio
            expr: |2
              sum(delta(eric_nrfagent_nnrf_oauth2_unsuccessful_responses_recv{nf_service_id="eric-nrfagent-accesstoken"}[1m])) by (detailed_info)
              /
              ignoring(detailed_info) group_left sum(delta(eric_nrfagent_nnrf_oauth2_requests_sent{nf_service_id="eric-nrfagent-accesstoken"}[1m])> 0 ) * 100
  eric-5gc-system-rules.yml: |
    groups:
      - name: eric_5gc_system
        rules:
          - record: pod:eric_5gc_system_cpu_usage:percent
            expr: |2
              sum(pmrm_container_cpu_usage_nanocore) by (pod,kubernetes_namespace)
              /
              sum(pmrm_container_cpu_limits_nanocore > 0) by (pod,kubernetes_namespace) * 100
          - record: pod:eric_5gc_system_memory_usage:percent
            expr: |2
              sum(pmrm_container_mem_usage_bytes) by (pod,kubernetes_namespace)
              /
              sum(pmrm_container_mem_limits_bytes > 0) by (pod,kubernetes_namespace) * 100
          - record: eric_ccsm_bro_scheduled_operation_error
            expr: bro_scheduled_operation_error
      - name: remote_write
        interval: 10s
        rules:
          - expr: prometheus_remote_storage_samples_total - prometheus_remote_storage_samples_retried_total
            record: prometheus_remote_storage_unknown_status_samples_total
          - expr: rate(prometheus_remote_storage_unknown_status_samples_total[1m])
            record: prometheus_remote_storage_succeeded_rate_samples_total
  eric-ccsm-smsorch-rules.yml: |
    groups:
      - name: eric_ccsm_smsorch_group_rule
        rules:
          - record: sum:eric_ccsm_smsorch_srism_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_ccsm_smsorch_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="PUT",resource='sri-sm'}[1m])))
              /
              (sum(rate(eric_ccsm_smsorch_requests_recv{operation="PUT",resource='sri-sm'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_ccsm_smsorch_rsds_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_ccsm_smsorch_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="PUT",resource='delivery-status'}[1m])))
              /
              (sum(rate(eric_ccsm_smsorch_requests_recv{operation="PUT",resource='delivery-status'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_ccsm_smsorch_alertscout_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_ccsm_smsorch_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="PUT",resource='outgoing-alert-sc'}[1m])))
              /
              (sum(rate(eric_ccsm_smsorch_requests_recv{operation="PUT",resource='outgoing-alert-sc'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_ccsm_smsorch_readyforsm_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_ccsm_smsorch_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="PUT",resource='ready-for-sm'}[1m])))
              /
              (sum(rate(eric_ccsm_smsorch_requests_recv{operation="PUT",resource='ready-for-sm'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_ccsm_smsorch_alertscin_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_ccsm_smsorch_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="PUT",resource='incoming-alert-sc'}[1m])))
              /
              (sum(rate(eric_ccsm_smsorch_requests_recv{operation="PUT",resource='incoming-alert-sc'}[1m])) > 0) * 100 or vector (0)
          - record: max:eric_ccsm_smsorch_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_ccsm_smsorch_srism_overload_unsuccessful_ratio:rate1m|sum:eric_ccsm_smsorch_rsds_overload_unsuccessful_ratio:rate1m|sum:eric_ccsm_smsorch_alertscout_overload_unsuccessful_ratio:rate1m|sum:eric_ccsm_smsorch_readyforsm_overload_unsuccessful_ratio:rate1m|sum:eric_ccsm_smsorch_alertscin_overload_unsuccessful_ratio:rate1m"})
{{/*
  Determines the UDM custom rule_files.
*/}}
{{- if ( index .Values "eric-ccsm-udm" "enabled" ) }}
  eric-ccsm-udm-rules.yml: |
    groups:
      - name: eric_ccsm_udm_group_rule
        rules:
          - record: max:eric_ccsm_aspect_authentication_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_udm_nudm_ueau_generateauth_overload_unsuccessful_ratio:rate1m"})
          - record: max:eric_ccsm_aspect_hssauthenticationservice_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_udm_nudm_ueau_generatehsseapakaauth_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_ueau_generatehsseapakaprimeauth_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_ueau_generatehssepsakaauth_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_ueau_generatehssgbaakaauth_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_ueau_generatehssimsakaauth_overload_unsuccessful_ratio:rate1m"})
          - record: max:eric_ccsm_aspect_pdusessionmngmt_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_udm_nudm_uecm_smfdereg_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_uecm_smfreg_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_smdata_overload_unsuccessful_ratio:rate1m"})
          - record: max:eric_ccsm_aspect_ueregistration_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_udm_nudm_sdm_amdata_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_smfselectdata_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_uectxtsmfdata_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_nssai_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_multipledataset_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_uecm_amfreg_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_uecm_amfregupdate_overload_unsuccessful_ratio:rate1m|sum:eric_udm_udr_notify_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_smssubdata_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_smsmngdata_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_uecsmsf_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_uecm_smsfreg_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_uecm_smsfdereg_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_uecm_amfdereg_overload_unsuccessful_ratio:rate1m"})
          - record: max:eric_ccsm_aspect_nudrnotifications_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_udm_nudm_sdm_notify_overload_unsuccessful_ratio:rate1m"})
          - record: max:eric_ccsm_aspect_applicationservices_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_udm_nudm_uecm_pcscfrestnotif_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_uecm_amfget_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_uecm_smsfregget_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_mt_ueinfo_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_mt_location_overload_unsuccessful_ratio:rate1m"})
          - record: max:eric_ccsm_aspect_mtsms_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_udm_nudm_mtsms_routinginfo_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_mtsms_deliverystatus_overload_unsuccessful_ratio:rate1m|sum:eric_ccsm_smsorch_srism_overload_unsuccessful_ratio:rate1m|sum:eric_ccsm_smsorch_rsds_overload_unsuccessful_ratio:rate1m|sum:eric_ccsm_smsorch_alertscout_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_mtsms_amfeesub_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_mtsms_amfeenotif_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_mtsms_readystatus_overload_unsuccessful_ratio:rate1m|sum:eric_ccsm_smsorch_readyforsm_overload_unsuccessful_ratio:rate1m|sum:eric_ccsm_smsorch_alertscin_overload_unsuccessful_ratio:rate1m"})
          - record: max:eric_ccsm_aspect_3gauthenticationservice_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_udm_umts_ueau_overload_unsuccessful_ratio:rate1m"})
          - record: max:eric_ccsm_aspect_eventexposure_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_udm_nudm_ee_subscribe_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_ee_unsubscribe_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_ee_amfnotification_overload_unsuccessful_ratio:rate1m"})
          - record: max:eric_ccsm_aspect_sdmsubscriptionhandling_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_udm_nudm_sdm_subscriptions_overload_unsuccessful_ratio:rate1m"})
  eric-ccsm-udm-ueau-rules.yml: |
    groups:
      - name: eric_ccsm_udm_ueau_group_rule
        rules:
          - record: sum:eric_udm_nudm_ueau_generateauth_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_ueau_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='SecurityInformation'}[1m])))
              /
              (sum(rate(eric_udm_nudm_ueau_requests_recv{resource='SecurityInformation'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_ueau_generatehsseapakaauth_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_ueau_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='HssSecurityInformation', req_info=~'eap-aka:.*'}[1m])))
               /
              (sum(rate(eric_udm_nudm_ueau_requests_recv{resource='HssSecurityInformation', req_info=~'eap-aka:.*'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_ueau_generatehsseapakaprimeauth_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_ueau_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='HssSecurityInformation', req_info=~'eap-aka-prime:.*'}[1m])))
               /
              (sum(rate(eric_udm_nudm_ueau_requests_recv{resource='HssSecurityInformation', req_info=~'eap-aka-prime:.*'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_ueau_generatehssepsakaauth_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_ueau_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='HssSecurityInformation', req_info=~'eps-aka:.*'}[1m])))
               /
              (sum(rate(eric_udm_nudm_ueau_requests_recv{resource='HssSecurityInformation', req_info=~'eps-aka:.*'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_ueau_generatehssgbaakaauth_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_ueau_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='HssSecurityInformation', req_info=~'gba-aka:.*'}[1m])))
               /
              (sum(rate(eric_udm_nudm_ueau_requests_recv{resource='HssSecurityInformation', req_info=~'gba-aka:.*'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_ueau_generatehssimsakaauth_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_ueau_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='HssSecurityInformation', req_info=~'ims-aka:.*'}[1m])))
               /
              (sum(rate(eric_udm_nudm_ueau_requests_recv{resource='HssSecurityInformation', req_info=~'ims-aka:.*'}[1m])) > 0) * 100 or vector (0)
          - record: max:eric_udm_nudm_ueau_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_udm_nudm_ueau_generateauth_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_ueau_generatehsseapakaauth_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_ueau_generatehsseapakaprimeauth_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_ueau_generatehssepsakaauth_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_ueau_generatehssgbaakaauth_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_ueau_generatehssimsakaauth_overload_unsuccessful_ratio:rate1m"})
          - record: sum:eric_udm_umts_ueau_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_umts_ueau_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='SendAuthenticationVectors'}[1m])))
               /
              (sum(rate(eric_udm_umts_ueau_requests_recv{resource='SendAuthenticationVectors'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_ueau_unauthorized_unsuccessful_ratio:rate1m
            expr: |2
              ((sum(rate(eric_udm_nudm_ueau_unsuccessful_responses_sent{status_code='401',detailed_info='invalid_token'}[1m])) or vector(0)) + (sum(rate(eric_udm_nudm_ueau_unsuccessful_responses_sent{status_code='401',detailed_info='token_not_present'}[1m])) or vector(0)))
              /
              (sum(rate(eric_udm_nudm_ueau_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_ueau_tps:rate1m
            expr: |2
              ((sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-eapauth.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-eapprimeauth.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-epsauth.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-gbaauth.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-imsauth.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-ueauth.*"}[1m]))) or vector(0))
          - record: sum:eric_udm_nudm_ueau_failure_ratio:rate1m
            expr: |2
              (((sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-eapauth.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-eapprimeauth.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-epsauth.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-gbaauth.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-imsauth.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-ueauth.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)))/(sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-eapauth.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-eapprimeauth.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-epsauth.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-gbaauth.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-imsauth.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-ueauth.*"}[1m])))>0) * 100 or vector(0)
  eric-ccsm-udm-uecm-rules.yml: |
    groups:
      - name: eric_ccsm_udm_uecm_group_rule
        rules:
          - record: sum:eric_udm_nudm_uecm_smfreg_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_uecm_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="PUT",resource='IndividualSmfRegistration'}[1m])))
              /
              (sum(rate(eric_udm_nudm_uecm_requests_recv{operation="PUT",resource='IndividualSmfRegistration'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_uecm_smfdereg_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_uecm_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="DELETE",resource='IndividualSmfRegistration'}[1m])))
              /
              (sum(rate(eric_udm_nudm_uecm_requests_recv{operation="DELETE",resource='IndividualSmfRegistration'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_uecm_amfreg_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_uecm_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="PUT",resource='Amf3GppAccessRegistration'}[1m])))
              /
              (sum(rate(eric_udm_nudm_uecm_requests_recv{operation="PUT",resource='Amf3GppAccessRegistration'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_uecm_amfregupdate_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_uecm_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="PATCH",resource='Amf3GppAccessRegistration'}[1m])))
              /
              (sum(rate(eric_udm_nudm_uecm_requests_recv{operation="PATCH",resource='Amf3GppAccessRegistration'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_uecm_amfget_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_uecm_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="GET",resource='Amf3GppAccessRegistration'}[1m])))
              /
              (sum(rate(eric_udm_nudm_uecm_requests_recv{operation="GET",resource='Amf3GppAccessRegistration'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_uecm_smsfreg_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_uecm_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="PUT",resource='Smsf3GppAccessRegistration'}[1m])))
              /
              (sum(rate(eric_udm_nudm_uecm_requests_recv{operation="PUT",resource='Smsf3GppAccessRegistration'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_uecm_smsfdereg_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_uecm_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="DELETE",resource='Smsf3GppAccessRegistration'}[1m])))
              /
              (sum(rate(eric_udm_nudm_uecm_requests_recv{operation="DELETE",resource='Smsf3GppAccessRegistration'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_uecm_smsfregget_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_uecm_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="GET",resource='Smsf3GppAccessRegistration'}[1m])))
              /
              (sum(rate(eric_udm_nudm_uecm_requests_recv{operation="GET",resource='Smsf3GppAccessRegistration'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_uecm_pcscfrestnotif_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_uecm_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='PCscfRestoration'}[1m])))
              /
              (sum(rate(eric_udm_nudm_uecm_requests_recv{resource='PCscfRestoration'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_uecm_amfdereg_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_uecm_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="POST",resource='Amf3GppAccessRegistration'}[1m])))
              /
              (sum(rate(eric_udm_nudm_uecm_requests_recv{operation="POST",resource='Amf3GppAccessRegistration'}[1m])) > 0) * 100 or vector (0)
          - record: max:eric_udm_nudm_uecm_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_udm_nudm_uecm_smfreg_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_uecm_smfdereg_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_uecm_amfreg_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_uecm_amfregupdate_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_uecm_amfget_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_uecm_smsfreg_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_uecm_smsfdereg_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_uecm_smsfregget_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_uecm_pcscfrestnotif_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_uecm_amfdereg_overload_unsuccessful_ratio:rate1m"})
          - record: sum:eric_udm_nudm_uecm_unauthorized_unsuccessful_ratio:rate1m
            expr: |2
              ((sum(rate(eric_udm_nudm_uecm_unsuccessful_responses_sent{status_code='401',detailed_info='invalid_token'}[1m])) or vector(0)) + (sum(rate(eric_udm_nudm_uecm_unsuccessful_responses_sent{status_code='401',detailed_info='token_not_present'}[1m])) or vector(0)))
              /
              (sum(rate(eric_udm_nudm_uecm_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_uecm_tps:rate1m
            expr: |2
              ((sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-iratamfdereg.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-pcscfrestnotif.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-uecmamfget.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-uecmamfregupdate.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-uecmreg.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-uecmsmfderegistration.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-uecmsmfregistration.*"}[1m])) +sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-uecmsmsfdereg.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-uecmsmsfregget.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-uecmsmsfregistration.*"}[1m]))) or vector(0))
          - record: sum:eric_udm_nudm_uecm_failure_ratio:rate1m
            expr: |2
              (((sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-iratamfdereg.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-pcscfrestnotif.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-uecmamfget.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-uecmamfregupdate.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-uecmreg.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-uecmsmfderegistration.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-uecmsmfregistration.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-uecmsmsfdereg.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-uecmsmsfregget.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-uecmsmsfregistration.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)))/(sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-iratamfdereg.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-pcscfrestnotif.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-uecmamfget.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-uecmamfregupdate.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-uecmreg.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-uecmsmfderegistration.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-uecmsmfregistration.*"}[1m])) +sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-uecmsmsfdereg.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-uecmsmsfregget.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-uecmsmsfregistration.*"}[1m])))>0) * 100 or vector(0)
  eric-ccsm-udm-sdm-rules.yml: |
    groups:
      - name: eric_ccsm_udm_sdm_group_rule
        rules:
          - record: sum:eric_udm_nudm_sdm_amdata_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_sdm_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='AccessAndMobilitySubscriptionData'}[1m])))
              /
              (sum(rate(eric_udm_nudm_sdm_requests_recv{resource='AccessAndMobilitySubscriptionData'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_sdm_smfselectdata_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_sdm_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='SmfSelectionSubscriptionData'}[1m])))
              /
              (sum(rate(eric_udm_nudm_sdm_requests_recv{resource='SmfSelectionSubscriptionData'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_sdm_smdata_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_sdm_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='SessionManagementSubscriptionData'}[1m])))
              /
              (sum(rate(eric_udm_nudm_sdm_requests_recv{resource='SessionManagementSubscriptionData'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_sdm_uectxtsmfdata_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_sdm_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='UeContextInSmfData'}[1m])))
              /
              (sum(rate(eric_udm_nudm_sdm_requests_recv{resource='UeContextInSmfData'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_sdm_subscriptions_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_sdm_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='SdmSubscriptions'}[1m])))
              /
              (sum(rate(eric_udm_nudm_sdm_requests_recv{resource='SdmSubscriptions'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_sdm_nssai_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_sdm_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='Nssai'}[1m])))
              /
              (sum(rate(eric_udm_nudm_sdm_requests_recv{resource='Nssai'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_sdm_multipledataset_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_sdm_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='Supi'}[1m])))
              /
              (sum(rate(eric_udm_nudm_sdm_requests_recv{resource='Supi'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_sdm_notify_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_sdm_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='UdmNotification'}[1m])))
              /
              (sum(rate(eric_udm_nudm_sdm_requests_recv{resource='UdmNotification'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_sdm_smssubdata_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_sdm_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="GET",resource='SMSSubscriptionData'}[1m])))
              /
              (sum(rate(eric_udm_nudm_sdm_requests_recv{operation="GET",resource='SMSSubscriptionData'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_sdm_smsmngdata_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_sdm_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="GET",resource='SMSManagementSubscriptionData'}[1m])))
              /
              (sum(rate(eric_udm_nudm_sdm_requests_recv{operation="GET",resource='SMSManagementSubscriptionData'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_sdm_uecsmsf_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_sdm_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="GET",resource='UEContextInSMSFData'}[1m])))
              /
              (sum(rate(eric_udm_nudm_sdm_requests_recv{operation="GET",resource='UEContextInSMSFData'}[1m])) > 0) * 100 or vector (0)
          - record: max:eric_udm_nudm_sdm_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_udm_nudm_sdm_amdata_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_smfselectdata_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_smdata_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_uectxtsmfdata_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_subscriptions_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_nssai_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_multipledataset_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_notify_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_smssubdata_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_smsmngdata_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_sdm_uecsmsf_overload_unsuccessful_ratio:rate1m"})
          - record: sum:eric_udm_nudm_sdm_unauthorized_unsuccessful_ratio:rate1m
            expr: |2
              ((sum(rate(eric_udm_nudm_sdm_unsuccessful_responses_sent{status_code='401',detailed_info='invalid_token'}[1m])) or vector(0)) + (sum(rate(eric_udm_nudm_sdm_unsuccessful_responses_sent{status_code='401',detailed_info='token_not_present'}[1m])) or vector(0)))
              /
              (sum(rate(eric_udm_nudm_sdm_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_sdm_tps:rate1m
            expr: |2
              ((sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmamdata.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmmultipledataset.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmnssai.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmsmdata.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmsmfselect.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmsmsdata.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmsmsmngdata.*"}[1m])) +sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmsubscriptions.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmuectxtsmf.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmuectxtsmsf.*"}[1m]))) or vector(0))
          - record: sum:eric_udm_nudm_sdm_failure_ratio:rate1m
            expr: |2
              (((sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-sdmamdata.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-sdmmultipledataset.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-sdmnssai.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-sdmsmdata.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-sdmsmfselect.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-sdmsmsdata.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-sdmsmsmngdata.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-sdmsubscriptions.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-sdmuectxtsmf.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-sdmuectxtsmsf.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)))/(sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmamdata.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmmultipledataset.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmnssai.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmsmdata.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmsmfselect.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmsmsdata.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmsmsmngdata.*"}[1m])) +sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmsubscriptions.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmuectxtsmf.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-sdmuectxtsmsf.*"}[1m])))>0) * 100 or vector(0)
  eric-ccsm-udm-udr-notify-rules.yml: |
    groups:
      - name: eric_ccsm_udm_udr_notify_group_rule
        rules:
          - record: sum:eric_udm_udr_notify_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_udr_notify_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",resource='PSLocationUpdate'}[1m])))
              /
              (sum(rate(eric_udm_udr_notify_requests_recv{resource='PSLocationUpdate'}[1m])) > 0) * 100 or vector (0)
  eric-ccsm-udm-mtsms-rules.yml: |
    groups:
      - name: eric_ccsm_udm_mtsms_group_rule
        rules:
          - record: sum:eric_udm_nudm_mtsms_routinginfo_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_mtsms_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="PUT",resource='SmsRoutingInfo'}[1m])))
              /
              (sum(rate(eric_udm_nudm_mtsms_requests_recv{operation="PUT",resource='SmsRoutingInfo'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_mtsms_deliverystatus_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_mtsms_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="PUT",resource='SmsDeliveryStatus'}[1m])))
              /
              (sum(rate(eric_udm_nudm_mtsms_requests_recv{operation="PUT",resource='SmsDeliveryStatus'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_mtsms_amfeesub_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_micro_amfeesubscriptions_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="POST",resource='AmfSubscriptions'}[1m])))
              /
              (sum(rate(eric_udm_micro_amfeesubscriptions_requests_recv{operation="POST",resource='AmfSubscriptions'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_mtsms_amfeenotif_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_namf_evts_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="POST",resource='AmfNotification'}[1m])))
              /
              (sum(rate(eric_udm_namf_evts_requests_recv{operation="POST",resource='AmfNotification'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_mtsms_readystatus_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_mtsms_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="PUT",resource='SmsReadyStatus'}[1m])))
              /
              (sum(rate(eric_udm_nudm_mtsms_requests_recv{operation="PUT",resource='SmsReadyStatus'}[1m])) > 0) * 100 or vector (0)
          - record: max:eric_udm_nudm_mtsms_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_udm_nudm_mtsms_routinginfo_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_mtsms_deliverystatus_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_mtsms_amfeesub_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_mtsms_amfeenotif_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_mtsms_readystatus_overload_unsuccessful_ratio:rate1m"})
  eric-ccsm-udm-mt-rules.yml: |
    groups:
      - name: eric_ccsm_udm_mt_group_rule
        rules:
          - record: sum:eric_udm_nudm_mt_ueinfo_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_mt_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='UeInfo'}[1m])))
              /
              (sum(rate(eric_udm_nudm_mt_requests_recv{resource='UeInfo'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_mt_location_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_mt_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='LocationInfo'}[1m])))
              /
              (sum(rate(eric_udm_nudm_mt_requests_recv{resource='LocationInfo'}[1m])) > 0) * 100 or vector (0)
          - record: max:eric_udm_nudm_mt_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_udm_nudm_mt_ueinfo_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_mt_location_overload_unsuccessful_ratio:rate1m"})
          - record: sum:eric_udm_nudm_mt_tps:rate1m
            expr: |2
              ((sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-mtlocation.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-mtueinfo.*"}[1m]))) or vector(0))
          - record: sum:eric_udm_nudm_mt_failure_ratio:rate1m
            expr: |2
              (((sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-mtlocation.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-mtueinfo.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)))/(sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-mtlocation.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-mtueinfo.*"}[1m])))>0) * 100 or vector(0)
  eric-ccsm-udm-ee-rules.yml: |
    groups:
      - name: eric_ccsm_udm_ee_group_rule
        rules:
          - record: sum:eric_udm_nudm_ee_subscribe_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_ee_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',operation="POST",resource='EeSubscription'}[1m])))
              /
              (sum(rate(eric_udm_nudm_ee_requests_recv{operation="POST",resource='EeSubscription'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_ee_unsubscribe_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_nudm_ee_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',operation="DELETE",resource='EeSubscription'}[1m])))
              /
              (sum(rate(eric_udm_nudm_ee_requests_recv{operation="DELETE",resource='EeSubscription'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_ee_amfnotification_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_udm_namf_evts_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",operation="POST",resource='EeSubsIdChangeNotification'}[1m])))
              /
              (sum(rate(eric_udm_namf_evts_requests_recv{operation="POST",resource='EeSubsIdChangeNotification'}[1m])) > 0) * 100 or vector (0)
          - record: max:eric_udm_nudm_ee_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_udm_nudm_ee_subscribe_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_ee_unsubscribe_overload_unsuccessful_ratio:rate1m|sum:eric_udm_nudm_ee_amfnotification_overload_unsuccessful_ratio:rate1m"})
          - record: sum:eric_udm_nudm_ee_unauthorized_unsuccessful_ratio:rate1m
            expr: |2
              ((sum(rate(eric_udm_nudm_ee_unsuccessful_responses_sent{status_code='401',detailed_info='invalid_token'}[1m])) or vector(0)) + (sum(rate(eric_udm_nudm_ee_unsuccessful_responses_sent{status_code='401',detailed_info='token_not_present'}[1m])) or vector(0)))
              /
              (sum(rate(eric_udm_nudm_ee_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_nudm_ee_tps:rate1m
            expr: |2
              ((sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-eesubscribe.*"}[1m])) + sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-eeunsubscribe.*"}[1m]))) or vector(0))
          - record: sum:eric_udm_nudm_ee_failure_ratio:rate1m
            expr: |2
              (((sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-eesubscribe.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) + (sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-udm-eeunsubscribe.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)))/(sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-eesubscribe.*"}[1m])) + sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-udm-eeunsubscribe.*"}[1m])))>0) * 100 or vector(0)
{{- end }}
{{/*
  Determines the AUSF custom rule_files.
*/}}
{{- if ( index .Values "eric-ccsm-ausf" "enabled" ) }}
  eric-ccsm-ausf-rules.yml: |
    groups:
      - name: eric_ccsm_ausf_group_rule
        rules:
          - record: sum:eric_ausf_nausf_auth_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_ausf_nausf_auth_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",resource='ue-authentications'}[1m])))
              /
              (sum(rate(eric_ausf_nausf_auth_requests_recv{resource='ue-authentications'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_ausf_nausf_auth_unauthorized_unsuccessful_ratio:rate1m
            expr: |2
              ((sum(rate(eric_ausf_nausf_auth_unsuccessful_responses_sent{status_code='401',detailed_info="invalid_token",resource='ue-authentications'}[1m])) or vector(0)) + (sum(rate(eric_ausf_nausf_auth_unsuccessful_responses_sent{status_code='401',detailed_info="token_not_present",resource='ue-authentications'}[1m])) or vector(0)))
              /
              (sum(rate(eric_ausf_nausf_auth_requests_recv{resource='ue-authentications'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_ccsm_aspect_ausf_authentication_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_ausf_nausf_auth_unsuccessful_responses_sent{detailed_info="NF_CONGESTION",resource='ue-authentications'}[1m])))
              /
              (sum(rate(eric_ausf_nausf_auth_requests_recv{resource='ue-authentications'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_ausf_nausf_auth_tps:rate1m
            expr: |2
              (sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-ausf-engine.*"}[1m])) or vector(0))
          - record: sum:eric_ausf_nausf_auth_failure_ratio:rate1m
            expr: |2
              ((sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-ausf-engine.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) / sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-ausf-engine.*"}[1m]))>0) * 100 or vector(0)
{{- end }}
{{/*
  Determines the EIR custom rule_files.
*/}}
{{- if ( index .Values "eric-ccsm-eir" "enabled" ) }}
  eric-ccsm-eireic-rules.yml: |
    groups:
      - name: eric_ccsm_eireic_group_rule
        rules:
          - record: sum:eric_eir_n5g_eir_eic_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_eir_n5g_eir_eic_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='equipmentStatus'}[1m])))
              /
              (sum(rate(eric_eir_n5g_eir_eic_requests_recv{resource='equipmentStatus'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_ccsm_aspect_5g_eir_equipmentcheck_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_eir_n5g_eir_eic_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='equipmentStatus'}[1m])))
              /
              (sum(rate(eric_eir_n5g_eir_eic_requests_recv{resource='equipmentStatus'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_eir_n5g_eir_eic_unauthorized_unsuccessful_ratio:rate1m
            expr: |2
              ((sum(rate(eric_eir_n5g_eir_eic_unsuccessful_responses_sent{status_code='401',detailed_info='invalid_token',resource='equipmentStatus'}[1m])) or vector(0))  + (sum(rate(eric_eir_n5g_eir_eic_unsuccessful_responses_sent{status_code='401',detailed_info='token_not_present',resource='equipmentStatus'}[1m])) or vector(0)))
              /
              (sum(rate(eric_eir_n5g_eir_eic_requests_recv{resource='equipmentStatus'}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_eir_n5g_eir_eic_tps:rate1m
            expr: |2
              (sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-eir-eireic.*"}[1m])) or vector(0))
          - record: sum:eric_eir_n5g_eir_eic_failure_ratio:rate1m
            expr: |2
              ((sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-eir-eireic.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) / sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-eir-eireic.*"}[1m]))>0) * 100 or vector(0)
  eric-ccsm-diameter-eireic-rules.yml: |
    groups:
      - name: eric_ccsm_diameter_eireic_group_rule
        rules:
          - record: sum:eric_eir_diameter_eir_eic_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_eir_s13_eic_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_eir_s13_eic_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_ccsm_aspect_eir_diameter_equipmentcheck_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_eir_s13_eic_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_eir_s13_eic_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_eir_s13_eic_tps:rate1m
            expr: (sum(rate(Diameter_TransTerm_Ordered{DiaApp="16777252",job="tls-pod-targets"}[1m])) or vector(0))
          - record: sum:eric_eir_s13_eic_failure_ratio:rate1m
            expr: |2
              ((sum(delta(Diameter_TransTerm_Failed{DiaApp="16777252",job="tls-pod-targets"}[1m])) or vector(0))
              /
              sum(delta(Diameter_TransTerm_Handled{DiaApp="16777252",job="tls-pod-targets"}[1m]))>0) * 100 or vector(0)
  eric-ccsm-map-eireic-rules.yml: |
    groups:
      - name: eric_ccsm_map_eireic_group_rule
        rules:
          - record: sum:eric_eir_map_eir_eic_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_eir_map_eir_eic_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_eir_map_eir_eic_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_ccsm_aspect_eir_map_equipmentcheck_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_eir_map_eir_eic_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_eir_map_eir_eic_requests_recv{}[1m])) > 0) * 100 or vector (0)
  eric-ccsm-eir-common-features-rules.yml: |
    groups:
      - name: eric_ccsm_eir_common_features_group_rule
        rules:
          - record: sum:eric_ccsm_aspect_eir_common_features_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_eir_n5g_eir_eic_unsuccessful_responses_sent{detailed_info='NF_CONGESTION',resource='equipmentStatus'}[1m])))
              /
              (sum(rate(eric_eir_n5g_eir_eic_requests_recv{resource='equipmentStatus'}[1m])) > 0) * 100 or (sum(rate(eric_eir_s13_eic_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_eir_s13_eic_requests_recv{}[1m])) > 0) * 100 or vector (0)
{{- end }}
{{/*
  Determines the HSSEPC custom rule_files.
*/}}
{{- if ( index .Values "eric-ccsm-hssepc" "enabled" ) }}
  eric-ccsm-hssepc-rules.yml: |
    groups:
      - name: eric_ccsm_hssepc_group_rule
        rules:
          - record: sum:eric_hss_s6a_air_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hss_s6a_air_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hss_s6a_air_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_hss_s6a_ulr_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hss_s6a_ulr_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hss_s6a_ulr_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_hss_s6a_nor_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hss_s6a_nor_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hss_s6a_nor_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_hss_s6a_pur_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hss_s6a_pur_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hss_s6a_pur_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: max:eric_hss_s6a_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_hss_s6a_air_overload_unsuccessful_ratio:rate1m|sum:eric_hss_s6a_ulr_overload_unsuccessful_ratio:rate1m|sum:eric_hss_s6a_nor_overload_unsuccessful_ratio:rate1m|sum:eric_hss_s6a_pur_overload_unsuccessful_ratio:rate1m"})
          - record: sum:eric_hssepc_s6a_tps:rate1m
            expr: (sum(rate(Diameter_TransTerm_Ordered{DiaApp="16777251",job="tls-pod-targets"}[1m])) or vector(0))
          - record: sum:eric_hssepc_s6a_failure_ratio:rate1m
            expr: |2
              ((sum(delta(Diameter_TransTerm_Failed{DiaApp="16777251",job="tls-pod-targets"}[1m])) or vector(0))
              /
              sum(delta(Diameter_TransTerm_Handled{DiaApp="16777251",job="tls-pod-targets"}[1m]))>0) * 100 or vector(0)
          - record: sum:eric_hssepc_swx_mar_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hssepc_swx_mar_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hssepc_swx_mar_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_hssepc_swx_sar_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hssepc_swx_sar_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hssepc_swx_sar_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: max:eric_hssepc_swx_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_hssepc_swx_mar_overload_unsuccessful_ratio:rate1m|sum:eric_hssepc_swx_sar_overload_unsuccessful_ratio:rate1m"})
          - record: sum:eric_hssepc_swx_tps:rate1m
            expr: (sum(rate(Diameter_TransTerm_Ordered{DiaApp="16777265",job="tls-pod-targets"}[1m])) or vector(0))
          - record: sum:eric_hssepc_swx_failure_ratio:rate1m
            expr: |2
              ((sum(delta(Diameter_TransTerm_Failed{DiaApp="16777265",job="tls-pod-targets"}[1m])) or vector(0))
              /
              sum(delta(Diameter_TransTerm_Handled{DiaApp="16777265",job="tls-pod-targets"}[1m]))>0) * 100 or vector(0)
          - record: sum:eric_hssepc_nhss_uecm_tps:rate1m
            expr: |2
              (sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-hssepc-iratsndereg.*"}[1m])) or vector(0))
          - record: sum:eric_hssepc_nhss_uecm_failure_ratio:rate1m
            expr: |2
              ((sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-hssepc-iratsndereg.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) / sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-hssepc-iratsndereg.*"}[1m]))>0) * 100 or vector(0)
          - record: sum:eric_hssepc_nhss_uecm_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hssepc_nhss_uecm_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hssepc_nhss_uecm_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_hssepc_nhssepc_mt_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hssepc_nhssepc_mt_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hssepc_nhssepc_mt_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_hssepc_nhssepc_uecm_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hssepc_nhssepc_uecm_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hssepc_nhssepc_uecm_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_hssepc_slh_rir_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hssepc_slh_rir_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hssepc_slh_rir_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: max:eric_hssepc_slh_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_hssepc_slh_rir_overload_unsuccessful_ratio:rate1m"})
          - record: sum:eric_hssepc_slh_tps:rate1m
            expr: (sum(rate(Diameter_TransTerm_Ordered{DiaApp="16777291",job="tls-pod-targets"}[1m])) or vector(0))
          - record: sum:eric_hssepc_slh_failure_ratio:rate1m
            expr: |2
              ((sum(delta(Diameter_TransTerm_Failed{DiaApp="16777291",job="tls-pod-targets"}[1m])) or vector(0))
              /
              sum(delta(Diameter_TransTerm_Handled{DiaApp="16777291",job="tls-pod-targets"}[1m]))>0) * 100 or vector(0)
          - record: sum:eric_hssepc_nudm_sdm_tps:rate1m
            expr: |2
              (sum(rate(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-hssepc-sdmnotify.*"}[1m])) or vector(0))
          - record: sum:eric_hssepc_nudm_sdm_failure_ratio:rate1m
            expr: |2
              ((sum(delta(envoy_cluster_upstream_rq{cluster_name=~".*eric-hssepc-sdmnotify.*",response_code_class=~"4xx|5xx"}[1m])) or vector(0)) / sum(delta(envoy_cluster_upstream_rq_completed{cluster_name=~".*eric-hssepc-sdmnotify.*"}[1m]))>0) * 100 or vector(0)
          - record: sum:eric_hssepc_nudm_sdm_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hssepc_nudm_sdm_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hssepc_nudm_sdm_requests_recv{}[1m])) > 0) * 100 or vector (0)

{{- end }}
{{/*
  Determines the HSS-IMS custom rule_files.
*/}}
{{- if ( index .Values "eric-ccsm-hssims" "enabled" ) }}
  eric-ccsm-hssims-rules.yml: |
    groups:
      - name: eric_ccsm_hssims_group_rule
        rules:
          - record: sum:eric_hssims_cx_uar_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hssims_cx_uar_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hssims_cx_uar_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_hssims_cx_mar_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hssims_cx_mar_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hssims_cx_mar_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_hssims_cx_sar_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hssims_cx_sar_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hssims_cx_sar_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_hssims_cx_lir_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hssims_cx_lir_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hssims_cx_lir_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: max:eric_hssims_cx_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_hssims_cx_uar_overload_unsuccessful_ratio:rate1m|sum:eric_hssims_cx_mar_overload_unsuccessful_ratio:rate1m|sum:eric_hssims_cx_sar_overload_unsuccessful_ratio:rate1m|sum:eric_hssims_cx_lir_overload_unsuccessful_ratio:rate1m"})
          - record: sum:eric_hssims_cx_tps:rate1m
            expr: (sum(rate(Diameter_TransTerm_Ordered{DiaApp="16777216",job="tls-pod-targets"}[1m])) or vector(0))
          - record: sum:eric_hssims_cx_failure_ratio:rate1m
            expr: |2
              ((sum(delta(Diameter_TransTerm_Failed{DiaApp="16777216",job="tls-pod-targets"}[1m])) or vector(0))
              /
              sum(delta(Diameter_TransTerm_Handled{DiaApp="16777216",job="tls-pod-targets"}[1m]))>0) * 100 or vector(0)
          - record: sum:eric_hssims_sh_udr_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hssims_sh_udr_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hssims_sh_udr_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_hssims_sh_pur_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hssims_sh_pur_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hssims_sh_pur_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_hssims_sh_snr_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hssims_sh_snr_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hssims_sh_snr_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: max:eric_hssims_sh_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_hssims_sh_udr_overload_unsuccessful_ratio:rate1m|sum:eric_hssims_sh_pur_overload_unsuccessful_ratio:rate1m|sum:eric_hssims_sh_snr_overload_unsuccessful_ratio:rate1m"})
          - record: sum:eric_hssims_sh_tps:rate1m
            expr: (sum(rate(Diameter_TransTerm_Ordered{DiaApp="16777217",job="tls-pod-targets"}[1m])) or vector(0))
          - record: sum:eric_hssims_sh_failure_ratio:rate1m
            expr: |2
              ((sum(delta(Diameter_TransTerm_Failed{DiaApp="16777217",job="tls-pod-targets"}[1m])) or vector(0))
              /
              sum(delta(Diameter_TransTerm_Handled{DiaApp="16777217",job="tls-pod-targets"}[1m]))>0) * 100 or vector(0)
          - record: sum:eric_hssims_zh_mar_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum(rate(eric_hssims_zh_mar_unsuccessful_responses_sent{detailed_info='NF_CONGESTION'}[1m])))
              /
              (sum(rate(eric_hssims_zh_mar_requests_recv{}[1m])) > 0) * 100 or vector (0)
          - record: max:eric_hssims_zh_overload_unsuccessful_ratio:rate1m
            expr: max({__name__=~"sum:eric_hssims_zh_mar_overload_unsuccessful_ratio:rate1m"})
          - record: sum:eric_hssims_zh_tps:rate1m
            expr: (sum(rate(Diameter_TransTerm_Ordered{DiaApp="16777221",job="tls-pod-targets"}[1m])) or vector(0))
          - record: sum:eric_hssims_zh_failure_ratio:rate1m
            expr: |2
              ((sum(delta(Diameter_TransTerm_Failed{DiaApp="16777221",job="tls-pod-targets"}[1m])) or vector(0))
              /
              sum(delta(Diameter_TransTerm_Handled{DiaApp="16777221",job="tls-pod-targets"}[1m]))>0) * 100 or vector(0)

{{- end }}
{{/*
  Determines the MAP sevice custom rule_files.
*/}}
{{- if index .Values "eric-ccsm-mapproxy" "enabled" }}
  eric-ccsm-map-tc-rules.yml: |
    groups:
      - name: eric_ccsm_map_tc_rule
        rules:
          - record: sum:eric_ccsm_tc_dialogue_primitive_sent_overload_ratio:rate1m
            expr: |2
              (sum by (service) (rate(eric_ccsm_tc_dialogue_primitive_sent{service=~"eric-ccsm-mapproxy-.*",status_code='congestion'}[1m])))
              /
              (sum by (service) (rate(eric_ccsm_tc_dialogue_primitive_recv{service=~"eric-ccsm-mapproxy-.*",resource='tc-begin'}[1m])) > 0) * 100
          - record: sum:eric_ccsm_map_outgoing_overload_unsuccessful_ratio:rate1m
            expr: |2
              (sum by (service) (rate(eric_ccsm_map_requests_unsent{service=~"eric-ccsm-mapproxy-.*",detailed_info='NF_CONGESTION'}[1m])))
              /
              ((sum by (service) (rate(eric_ccsm_tc_dialogue_primitive_sent{service=~"eric-ccsm-mapproxy-.*",resource='tc-begin'}[1m])) > 0)+(sum by (service) (rate(eric_ccsm_map_requests_unsent{service=~"eric-ccsm-mapproxy-.*"}[1m])))) * 100
          - record: max:eric_ccsm_map_overload_unsuccessful_ratio:rate1m
            expr: max by (service) ({__name__=~"sum:eric_ccsm_tc_dialogue_primitive_sent_overload_ratio:rate1m|sum:eric_ccsm_map_outgoing_overload_unsuccessful_ratio:rate1m"})
          - record: sum:eric_udm_map_umts_ueau_tps:rate1m
            expr: (sum(rate(eric_ccsm_map_requests_recv{resource="SAV"}[1m])) or vector(0))
          - record: sum:eric_udm_map_umts_ueau_failure_ratio:rate1m
            expr: |2
              ((sum(delta(eric_ccsm_map_unsuccessful_responses_sent{resource="SAV"}[1m])) or vector(0))
              /
              sum(delta(eric_ccsm_map_requests_recv{resource="SAV"}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_eir_map_eir_eic_tps:rate1m
            expr: (sum(rate(eric_ccsm_map_requests_recv{resource="CHECKIMEI"}[1m])) or vector(0))
          - record: sum:eric_eir_map_eir_eic_failure_ratio:rate1m
            expr: |2
              ((sum(delta(eric_ccsm_map_unsuccessful_responses_sent{resource="CHECKIMEI"}[1m])) or vector(0))
              /
              sum(delta(eric_ccsm_map_requests_recv{resource="CHECKIMEI"}[1m])) > 0) * 100 or vector (0)
          - record: sum:eric_udm_map_mtsms_tps:rate1m
            expr: (sum(rate(eric_ccsm_map_requests_recv{resource=~"SRIFSM|RSMDS|ALERTSC|RFSM"}[1m])) or vector(0))
          - record: sum:eric_udm_map_mtsms_failure_ratio:rate1m
            expr: |2
              ((sum(delta(eric_ccsm_map_unsuccessful_responses_sent{resource=~"SRIFSM|RSMDS|ALERTSC|RFSM"}[1m])) or vector (0))
              /
              sum(delta(eric_ccsm_map_requests_recv{resource=~"SRIFSM|RSMDS|ALERTSC|RFSM"}[1m])) > 0) * 100 or vector (0)
{{- end }}
{{- end }}
  prometheus.yml: |
    global:
      scrape_interval: 15s
      scrape_timeout: 10s
      evaluation_interval: 1m
    remote_write:
      - url: 'http://eric-odca-diagnostic-data-collector:50050/receive'
        write_relabel_configs:
          - source_labels: [__name__]
            regex: 'eric_.*'
            action: keep
{{- $pm := (index .Values "eric-ccsm-adp" "eric-pm-server") }}
{{- if $pm.externalRemoteWrite }}
{{- if ( eq ( index .Values "eric-ccsm-adp" "eric-pm-server" "limitRWDestionations" ) false) }}
{{ toYaml $pm.externalRemoteWrite | indent 6 }}
{{- end }}
{{- if ( eq ( index .Values "eric-ccsm-adp" "eric-pm-server" "limitRWDestionations" ) true) }}
{{- $pm1 := (index $pm.externalRemoteWrite 0) }}
{{ toYaml $pm1 | indent 6 }}
{{- end }}
{{- end }}
{{- if or ( index .Values "eric-ccsm-udm" "enabled" ) ( index .Values "eric-ccsm-ausf" "enabled" ) ( index .Values "eric-ccsm-eir" "enabled" ) ( index .Values "eric-ccsm-mapproxy" "enabled" ) ( index .Values "eric-ccsm-hssepc" "enabled" ) ( index .Values "eric-ccsm-hssims" "enabled" ) }}
    rule_files:
      - eric-adp-5g-udm-pol-rules.yml
      - eric-nrfagent-rules.yml
      - eric-5gc-system-rules.yml
      - eric-ccsm-smsorch-rules.yml
{{- if ( index .Values "eric-ccsm-udm" "enabled" ) }}
      - eric-ccsm-udm-rules.yml
      - eric-ccsm-udm-ueau-rules.yml
      - eric-ccsm-udm-uecm-rules.yml
      - eric-ccsm-udm-sdm-rules.yml
      - eric-ccsm-udm-udr-notify-rules.yml
      - eric-ccsm-udm-mtsms-rules.yml
      - eric-ccsm-udm-mt-rules.yml
      - eric-ccsm-udm-ee-rules.yml
{{- end }}
{{- if ( index .Values "eric-ccsm-ausf" "enabled" ) }}
      - eric-ccsm-ausf-rules.yml
{{- end }}
{{- if ( index .Values "eric-ccsm-eir" "enabled" ) }}
      - eric-ccsm-eireic-rules.yml
      - eric-ccsm-diameter-eireic-rules.yml
      - eric-ccsm-map-eireic-rules.yml
      - eric-ccsm-eir-common-features-rules.yml
{{- end }}
{{- if index .Values "eric-ccsm-mapproxy" "enabled" }}
      - eric-ccsm-map-tc-rules.yml
{{- end }}
{{- if ( index .Values "eric-ccsm-hssepc" "enabled" ) }}
      - eric-ccsm-hssepc-rules.yml
{{- end }}
{{- if ( index .Values "eric-ccsm-hssims" "enabled" ) }}
      - eric-ccsm-hssims-rules.yml
{{- end }}
{{- end }}
    scrape_configs:
      - job_name: prometheus
        static_configs:
          - targets:
            - localhost:9090
      - job_name: pm-exporter
        static_configs:
          - targets:
            - localhost:9087
            labels:
              kubernetes_namespace: {{ .Release.Namespace }}
{{- if include "eric-ccsm.security.tls.enabled" . }}
        scheme: https
        tls_config:
          ca_file: /run/secrets/cacert/cacertbundle.pem
          cert_file: /run/secrets/clicert/clicert.pem
          key_file: /run/secrets/clicert/cliprivkey.pem
          server_name: certified-scrape-target
          insecure_skip_verify: false
      - job_name: tls-targets
        scheme: https
        tls_config:
          ca_file: /run/secrets/cacert/cacertbundle.pem
          cert_file: /run/secrets/clicert/clicert.pem
          key_file: /run/secrets/clicert/cliprivkey.pem
          server_name: certified-scrape-target
          insecure_skip_verify: false
        kubernetes_sd_configs:
          - role: endpoints
            namespaces:
              names:
                - {{ .Release.Namespace }}
        relabel_configs:
          - source_labels: [__meta_kubernetes_service_name]
            action: replace
            target_label: job
          - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape]
            action: keep
            regex: true
          - source_labels: [__meta_kubernetes_endpoint_port_name]
            action: keep
            regex: (.*-tls)
          - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scheme]
            action: replace
            target_label: __scheme__
            regex: (https?)
          - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_path]
            action: replace
            target_label: __metrics_path__
            regex: (.+)
          - source_labels: [__address__, __meta_kubernetes_service_annotation_prometheus_io_port]
            action: replace
            target_label: __address__
            regex: ((?:\[.+\])|(?:.+))(?::\d+);(\d+)
            replacement: $1:$2
          - action: labelmap
            regex: __meta_kubernetes_service_label_(.+)
          - source_labels: [__meta_kubernetes_namespace]
            action: replace
            target_label: kubernetes_namespace
          - source_labels: [__meta_kubernetes_service_name]
            action: replace
            target_label: kubernetes_name
      - job_name: 'tls-pod-targets'
        honor_timestamps: true
        scrape_interval: 15s
        scrape_timeout: 10s
        metrics_path: /metrics
        scheme: https
        tls_config:
          ca_file: /run/secrets/cacert/cacertbundle.pem
          cert_file: /run/secrets/clicert/clicert.pem
          key_file: /run/secrets/clicert/cliprivkey.pem
          server_name: certified-scrape-target
          insecure_skip_verify: false
        kubernetes_sd_configs:
          - role: pod
            namespaces:
              names:
                - {{ .Release.Namespace }}
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
            separator: ;
            regex: "true"
            replacement: $1
            action: keep
          - source_labels: [__meta_kubernetes_pod_container_port_name]
            separator: ;
            regex: (.*-tls)
            replacement: $1
            action: keep
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
            separator: ;
            regex: (.+)
            target_label: __metrics_path__
            replacement: $1
            action: replace
          - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
            separator: ;
            regex: ((?:\[.+\])|(?:.+))(?::\d+);(\d+)
            target_label: __address__
            replacement: $1:$2
            action: replace
          - separator: ;
            regex: __meta_kubernetes_pod_label_(.+)
            replacement: $1
            action: labelmap
          - source_labels: [__meta_kubernetes_namespace]
            separator: ;
            regex: (.*)
            target_label: kubernetes_namespace
            replacement: $1
            action: replace
          - source_labels: [__meta_kubernetes_pod_name]
            separator: ;
            regex: (.*)
            target_label: kubernetes_pod_name
            replacement: $1
            action: replace
      - job_name: 'tls-pod-targets-2'
        honor_timestamps: true
        scrape_interval: 15s
        scrape_timeout: 10s
        metrics_path: /metrics
        scheme: https
        tls_config:
          ca_file: /run/secrets/cacert/cacertbundle.pem
          cert_file: /run/secrets/clicert/clicert.pem
          key_file: /run/secrets/clicert/cliprivkey.pem
          server_name: certified-scrape-target
          insecure_skip_verify: false
        kubernetes_sd_configs:
          - role: pod
            namespaces:
              names:
                - {{ .Release.Namespace }}
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
            separator: ;
            regex: "true"
            replacement: $1
            action: keep
          - source_labels: [__meta_kubernetes_pod_container_port_name]
            separator: ;
            regex: (.*-tls)
            replacement: $1
            action: keep
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_port2]
            separator: ;
            regex: (\d+)
            replacement: $1
            action: keep
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scheme2]
            separator: ;
            regex: (https?)
            target_label: __scheme__
            replacement: $1
            action: replace
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path2]
            separator: ;
            regex: (.+)
            target_label: __metrics_path__
            replacement: $1
            action: replace
          - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port2]
            separator: ;
            regex: ((?:\[.+\])|(?:.+))(?::\d+);(\d+)
            target_label: __address__
            replacement: $1:$2
            action: replace
          - separator: ;
            regex: __meta_kubernetes_pod_label_(.+)
            replacement: $1
            action: labelmap
          - source_labels: [__meta_kubernetes_namespace]
            separator: ;
            regex: (.*)
            target_label: kubernetes_namespace
            replacement: $1
            action: replace
          - source_labels: [__meta_kubernetes_pod_name]
            separator: ;
            regex: (.*)
            target_label: kubernetes_pod_name
            replacement: $1
            action: replace
{{- end }}
{{ if ( eq ( index .Values "eric-ccsm-adp" "eric-pm-server" "rbac" "appMonitoring" "enabled" ) true) }}
{{ if ( eq ( index .Values "eric-ccsm-adp" "eric-pm-server" "rbac" "appMonitoring" "federation" "jobOverride") false) }}
      - job_name: 'federate-victoria'
        scrape_interval: 15s

        honor_labels: true
        metrics_path: '/select/0/prometheus/federate'

        params:
          'match[]':
            - '{job="kubernetes-nodes",namespace={{ .Release.Namespace | quote }}}'
        static_configs:
          - targets:
            - 'eric-victoria-metrics-cluster-vmselect.monitoring:8481'
{{- end }}
{{ if ( eq ( index .Values "eric-ccsm-adp" "eric-pm-server" "rbac" "appMonitoring" "federation" "jobOverride") true) }}
      {{ index .Values "eric-ccsm-adp" "eric-pm-server" "rbac" "appMonitoring" "federation" "jobConfiguration" | indent 6 | trim }}
{{- end }}
{{- end }}

{{ if ( eq ( index .Values "eric-ccsm-adp" "eric-pm-server" "rbac" "appMonitoring" "enabled" ) false) }}
      - job_name: 'kubernetes-nodes'

        # Default to scraping over https. If required, just disable this or change to
        # `http`.
        scheme: https

        # This TLS & bearer token file config is used to connect to the actual scrape
        # endpoints for cluster components. This is separate to discovery auth
        # configuration because discovery & scraping are two separate concerns in
        # Prometheus. The discovery auth config is automatic if Prometheus runs inside
        # the cluster. Otherwise, more config options have to be provided within the
        # <kubernetes_sd_config>.
        tls_config:
          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
          # If your node certificates are self-signed or use a different CA to the
          # master CA, then disable certificate verification below. Note that
          # certificate verification is an integral part of a secure infrastructure
          # so this should only be disabled in a controlled environment. You can
          # disable certificate verification by uncommenting the line below.
          #
          insecure_skip_verify: false
        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token

        kubernetes_sd_configs:
          - role: node
            namespaces:
              names:
                - {{ .Release.Namespace }}

        relabel_configs:
          - action: labelmap
            regex: __meta_kubernetes_node_label_(.+)
          - target_label: __address__
            replacement: kubernetes.default.svc:443
          - source_labels: [__meta_kubernetes_node_name]
            regex: (.+)
            target_label: __metrics_path__
            replacement: /api/v1/nodes/${1}/proxy/metrics
        metric_relabel_configs:
          - source_labels: ['namespace']
            regex: '{{ .Release.Namespace }}'
            action: 'keep'

{{- end }}
      # Scrape config for service endpoints.
      #
      # The relabeling allows the actual service scrape endpoint to be configured
      # via the following annotations:
      #
      # * `prometheus.io/scrape`: Only scrape services that have a value of `true`
      # * `prometheus.io/scheme`: If the metrics endpoint is secured then you will need
      # to set this to `https` & most likely set the `tls_config` of the scrape config.
      # * `prometheus.io/path`: If the metrics path is not `/metrics` override this.
      # * `prometheus.io/port`: If the metrics are exposed on a different port to the
      # service then set this appropriately.
      - job_name: 'kubernetes-service-endpoints'

        kubernetes_sd_configs:
          - role: endpoints
            namespaces:
              names:
                - {{ .Release.Namespace }}

        relabel_configs:
          - source_labels: [__meta_kubernetes_service_name]
            action: replace
            target_label: job
          - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape]
            action: keep
            regex: true
          - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scheme]
            action: drop
            regex: (https?)
          - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_path]
            action: replace
            target_label: __metrics_path__
            regex: (.+)
          - source_labels: [__address__, __meta_kubernetes_service_annotation_prometheus_io_port]
            action: replace
            target_label: __address__
            regex: ((?:\[.+\])|(?:.+))(?::\d+);(\d+)
            replacement: $1:$2
          - action: labelmap
            regex: __meta_kubernetes_service_label_(.+)
          - source_labels: [__meta_kubernetes_namespace]
            action: replace
            target_label: kubernetes_namespace
          - source_labels: [__meta_kubernetes_service_name]
            action: replace
            target_label: kubernetes_name
          - source_labels: [__meta_kubernetes_endpoint_port_name]
            action: keep
            regex: (http-metrics.*)

      # Example scrape config for probing services via the Blackbox Exporter.
      #
      # The relabeling allows the actual service scrape endpoint to be configured
      # via the following annotations:
      #
      # * `prometheus.io/probe`: Only probe services that have a value of `true`
      - job_name: 'kubernetes-services'

        metrics_path: /probe
        params:
          module: [http_2xx]

        kubernetes_sd_configs:
          - role: service
            namespaces:
              names:
                - {{ .Release.Namespace }}

        relabel_configs:
          - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_probe]
            action: keep
            regex: true
          - source_labels: [__address__]
            target_label: __param_target
          - target_label: __address__
            replacement: blackbox
          - source_labels: [__param_target]
            target_label: instance
          - action: labelmap
            regex: __meta_kubernetes_service_label_(.+)
          - source_labels: [__meta_kubernetes_namespace]
            target_label: kubernetes_namespace
          - source_labels: [__meta_kubernetes_service_name]
            target_label: kubernetes_name
          - source_labels: [__meta_kubernetes_service_port_name]
            action: keep
            regex: 'http-metrics.*'
          - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape]
            action: keep
            regex: true
          - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scheme]
            action: replace
            target_label: __scheme__
            regex: (https?)
          - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_path]
            action: replace
            target_label: __metrics_path__
            regex: (.+)

      # Temporary WA for scraping DCED service
      - job_name: dced
        static_configs:
          - targets:
            - eric-data-distributed-coordinator-ed:2379
        scheme: https
        tls_config:
          ca_file: /var/run/secrets/etcd/cacert/cacertbundle.pem
          cert_file: /var/run/secrets/etcd/client/clicert.pem
          key_file: /var/run/secrets/etcd/client/cliprivkey.pem
          insecure_skip_verify: false

      # Example scrape config for pods
      #
      # The relabeling allows the actual pod scrape endpoint to be configured via the
      # following annotations:
      #
      # * `prometheus.io/scrape`: Only scrape pods that have a value of `true`
      # * `prometheus.io/path`: If the metrics path is not `/metrics` override this.
      # * `prometheus.io/port`: Scrape the pod on the indicated port instead of the default of `9102`.
      - job_name: 'kubernetes-pods'

        kubernetes_sd_configs:
          - role: pod
            namespaces:
              names:
                - {{ .Release.Namespace }}

        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
            action: keep
            regex: true
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
            action: replace
            target_label: __metrics_path__
            regex: (.+)
          - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
            action: replace
            regex: ((?:\[.+\])|(?:.+))(?::\d+);(\d+)
            replacement: $1:$2
            target_label: __address__
          - action: labelmap
            regex: __meta_kubernetes_pod_label_(.+)
          - source_labels: [__meta_kubernetes_namespace]
            action: replace
            target_label: kubernetes_namespace
          - source_labels: [__meta_kubernetes_pod_name]
            action: replace
            target_label: kubernetes_pod_name
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scheme]
            action: drop
            regex: https
          - source_labels: [__meta_kubernetes_pod_name]
            action: drop
            regex: eric-data-distributed-coordinator-ed.*

      - job_name: ccsm-pods
        scheme: https
        tls_config:
          ca_file: /run/secrets/cacert/cacertbundle.pem
          cert_file: /run/secrets/clicert/clicert.pem
          key_file: /run/secrets/clicert/cliprivkey.pem
          server_name: eric-ccsm-certified-scrape-target
          insecure_skip_verify: false
        kubernetes_sd_configs:
           - role: pod
             namespaces:
               names:
                 - {{ .Release.Namespace }}
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_container_port_name]
            action: keep
            regex: metrics
          - source_labels: [__meta_kubernetes_pod_label_tls_ccsm_ericsson_com_pmCa]
            action: keep
            regex: (.+)
          - action: labelmap
            regex: _meta_kubernetes_pod_label(.+)
          - source_labels: [__meta_kubernetes_namespace]
            action: replace
            target_label: kubernetes_namespace
          - source_labels: [__meta_kubernetes_pod_name]
            action: replace
            target_label: kubernetes_pod_name

      - job_name: 'kubernetes-https-pods'
        scheme: https
        tls_config:
{{- if include "eric-ccsm.security.tls.enabled" . }}
          ca_file: /run/secrets/cacert/cacertbundle.pem
          cert_file: /run/secrets/clicert/clicert.pem
          key_file: /run/secrets/clicert/cliprivkey.pem
          server_name: certified-scrape-target
{{- end }}
          insecure_skip_verify: false

        kubernetes_sd_configs:
          - role: pod
            namespaces:
              names:
                - {{ .Release.Namespace }}
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
            action: keep
            regex: true
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
            action: replace
            target_label: __metrics_path__
            regex: (.+)
          - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
            action: replace
            regex: (([^:]+)|(\[(?:[a-zA-Z0-9]{0,4}:?){1,8}\]|\[(?:[a-zA-Z0-9]{0,4}:?){1,4}(?:[0-9]{1,3}\.){3}[0-9]{1,3}\]))(?::\d+)?;(\d+)
            replacement: ${1}:${4}
            target_label: __address__
          - action: labelmap
            regex: _meta_kubernetes_pod_label(.+)
          - source_labels: [__meta_kubernetes_namespace]
            action: replace
            target_label: kubernetes_namespace
          - source_labels: [__meta_kubernetes_pod_name]
            action: replace
            target_label: kubernetes_pod_name
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scheme]
            action: keep
            regex: https

      # Scrape config for sm
      - job_name: 'sm-controller'
        kubernetes_sd_configs:
        - role: endpoints
          namespaces:
            names:
              - {{ .Release.Namespace }}

        relabel_configs:
        - source_labels: [__meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
          action: keep
          regex: istio-pilot;http-monitoring

      - job_name: 'sm-certmgr'
        kubernetes_sd_configs:
        - role: endpoints
          namespaces:
            names:
              - {{ .Release.Namespace }}

        relabel_configs:
        - source_labels: [__meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
          action: keep
          regex: istio-citadel;http-monitoring

      - job_name: 'sm-sidecar-injector'
        kubernetes_sd_configs:
        - role: endpoints
          namespaces:
            names:
              - {{ .Release.Namespace }}

        relabel_configs:
        - source_labels: [__meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
          action: keep
          regex: istio-sidecar-injector;http-monitoring
{{- end }}
{{- end }}
